{"version":3,"file":"table-of-contents/view.js","mappings":"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","sources":["webpack://fse-pilot/./mu-plugins/fse-pilot-blocks/src/table-of-contents/view.js"],"sourcesContent":["/**\n * Table of Contents frontend JavaScript.\n *\n * Handles:\n * - Adding IDs to headings in post content\n * - Smooth scrolling to anchors\n * - Active state tracking via Intersection Observer\n */\n\n/* global IntersectionObserver */\n\n( function () {\n\t'use strict';\n\n\t/**\n\t * Generate a sanitized ID from heading text (matching PHP logic).\n\t *\n\t * @param {string} text - Heading text content.\n\t * @return {string} Sanitized ID with 'toc-' prefix.\n\t */\n\tfunction generateHeadingId( text ) {\n\t\treturn (\n\t\t\t'toc-' +\n\t\t\ttext\n\t\t\t\t.toLowerCase()\n\t\t\t\t.trim()\n\t\t\t\t.replace( /[^\\w\\s-]/g, '' ) // Remove special characters\n\t\t\t\t.replace( /\\s+/g, '-' ) // Replace spaces with hyphens\n\t\t\t\t.replace( /-+/g, '-' ) // Replace multiple hyphens with single\n\t\t);\n\t}\n\n\t/**\n\t * Add IDs to H2 and H3 headings in post content.\n\t */\n\tfunction addHeadingIds() {\n\t\t// Find post content container.\n\t\tconst postContent = document.querySelector(\n\t\t\t'.entry-content, .wp-block-post-content'\n\t\t);\n\t\tif ( ! postContent ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Get all H2 and H3 headings.\n\t\tconst headings = postContent.querySelectorAll( 'h2, h3' );\n\n\t\theadings.forEach( ( heading ) => {\n\t\t\t// Skip if heading already has an ID.\n\t\t\tif ( heading.id ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst text = heading.textContent || '';\n\t\t\tif ( text.trim() ) {\n\t\t\t\theading.id = generateHeadingId( text );\n\t\t\t}\n\t\t} );\n\t}\n\n\t/**\n\t * Setup smooth scrolling for TOC links.\n\t */\n\tfunction setupSmoothScroll() {\n\t\tconst tocLinks = document.querySelectorAll( '.toc-item' );\n\n\t\ttocLinks.forEach( ( link ) => {\n\t\t\tlink.addEventListener( 'click', ( event ) => {\n\t\t\t\tconst href = link.getAttribute( 'href' );\n\t\t\t\tif ( ! href || ! href.startsWith( '#' ) ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst targetId = href.substring( 1 );\n\t\t\t\tconst targetElement = document.getElementById( targetId );\n\n\t\t\t\tif ( targetElement ) {\n\t\t\t\t\tevent.preventDefault();\n\n\t\t\t\t\t// Scroll to target with offset for sticky header.\n\t\t\t\t\tconst headerOffset = 100; // Adjust based on sticky header height.\n\t\t\t\t\tconst elementPosition =\n\t\t\t\t\t\ttargetElement.getBoundingClientRect().top;\n\t\t\t\t\tconst offsetPosition =\n\t\t\t\t\t\telementPosition + window.pageYOffset - headerOffset;\n\n\t\t\t\t\twindow.scrollTo( {\n\t\t\t\t\t\ttop: offsetPosition,\n\t\t\t\t\t\tbehavior: 'smooth',\n\t\t\t\t\t} );\n\n\t\t\t\t\t// Update URL hash without jumping.\n\t\t\t\t\twindow.history.pushState( null, null, href );\n\t\t\t\t}\n\t\t\t} );\n\t\t} );\n\t}\n\n\t/**\n\t * Setup scroll tracking with Intersection Observer.\n\t */\n\tfunction setupScrollTracking() {\n\t\tconst tocLinks = document.querySelectorAll( '.toc-item' );\n\t\tif ( ! tocLinks.length ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Get all heading IDs from TOC links.\n\t\tconst headingIds = Array.from( tocLinks )\n\t\t\t.map( ( link ) => {\n\t\t\t\tconst href = link.getAttribute( 'href' );\n\t\t\t\treturn href ? href.substring( 1 ) : null;\n\t\t\t} )\n\t\t\t.filter( Boolean );\n\n\t\t// Get corresponding heading elements.\n\t\tconst headings = headingIds\n\t\t\t.map( ( id ) => document.getElementById( id ) )\n\t\t\t.filter( Boolean );\n\n\t\tif ( ! headings.length ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Track the currently active heading.\n\t\tlet activeHeadingId = null;\n\n\t\t/**\n\t\t * Update active state on TOC links.\n\t\t *\n\t\t * @param {string|null} headingId - ID of the active heading.\n\t\t */\n\t\tfunction setActiveLink( headingId ) {\n\t\t\tif ( headingId === activeHeadingId ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tactiveHeadingId = headingId;\n\n\t\t\t// Remove active class from all links.\n\t\t\ttocLinks.forEach( ( link ) => {\n\t\t\t\tlink.classList.remove( 'is-active' );\n\t\t\t} );\n\n\t\t\t// Add active class to matching link.\n\t\t\tif ( headingId ) {\n\t\t\t\tconst activeLink = document.querySelector(\n\t\t\t\t\t`.toc-item[href=\"#${ headingId }\"]`\n\t\t\t\t);\n\t\t\t\tif ( activeLink ) {\n\t\t\t\t\tactiveLink.classList.add( 'is-active' );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Create Intersection Observer.\n\t\tconst observerOptions = {\n\t\t\troot: null, // Viewport.\n\t\t\trootMargin: '-100px 0px -66% 0px', // Top offset for header, bottom threshold.\n\t\t\tthreshold: 0,\n\t\t};\n\n\t\tconst observer = new IntersectionObserver( ( entries ) => {\n\t\t\tentries.forEach( ( entry ) => {\n\t\t\t\tif ( entry.isIntersecting ) {\n\t\t\t\t\tsetActiveLink( entry.target.id );\n\t\t\t\t}\n\t\t\t} );\n\t\t}, observerOptions );\n\n\t\t// Observe all headings.\n\t\theadings.forEach( ( heading ) => {\n\t\t\tobserver.observe( heading );\n\t\t} );\n\n\t\t// Set initial active state based on scroll position.\n\t\tconst setInitialActive = () => {\n\t\t\tfor ( const heading of headings ) {\n\t\t\t\tconst rect = heading.getBoundingClientRect();\n\t\t\t\tif ( rect.top >= 0 && rect.top < window.innerHeight / 2 ) {\n\t\t\t\t\tsetActiveLink( heading.id );\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// Run on load.\n\t\tsetInitialActive();\n\t}\n\n\t/**\n\t * Initialize TOC functionality.\n\t */\n\tfunction init() {\n\t\t// Check if TOC block exists on page.\n\t\tconst tocBlock = document.querySelector(\n\t\t\t'.wp-block-fse-pilot-table-of-contents'\n\t\t);\n\t\tif ( ! tocBlock ) {\n\t\t\treturn;\n\t\t}\n\n\t\taddHeadingIds();\n\t\tsetupSmoothScroll();\n\t\tsetupScrollTracking();\n\t}\n\n\t// Run when DOM is ready.\n\tif ( document.readyState === 'loading' ) {\n\t\tdocument.addEventListener( 'DOMContentLoaded', init );\n\t} else {\n\t\tinit();\n\t}\n} )();\n"],"names":["generateHeadingId","text","toLowerCase","trim","replace","addHeadingIds","postContent","document","querySelector","headings","querySelectorAll","forEach","heading","id","textContent","setupSmoothScroll","tocLinks","link","addEventListener","event","href","getAttribute","startsWith","targetId","substring","targetElement","getElementById","preventDefault","headerOffset","elementPosition","getBoundingClientRect","top","offsetPosition","window","pageYOffset","scrollTo","behavior","history","pushState","setupScrollTracking","length","headingIds","Array","from","map","filter","Boolean","activeHeadingId","setActiveLink","headingId","classList","remove","activeLink","add","observerOptions","root","rootMargin","threshold","observer","IntersectionObserver","entries","entry","isIntersecting","target","observe","setInitialActive","rect","innerHeight","init","tocBlock","readyState"],"sourceRoot":""}